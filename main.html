<?php session_start(); 
  if(isset($_SESSION['id']))
  {
    header('Location: map.html');
  }
?>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Login</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous"> 
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body>


  <form action="<?php echo $_SERVER['PHP_SELF'] ?>" method="post">
    <h1 class="page-header">Login </h1>
    <div class="form-group">
          <label for="id"><b>Email:</b></label> 
          <div class="col-12">
              <input id="email" name="email" type="email" class="form-control" required="required">
          </div>
      </div>

      <div class="form-group">
          <label for="password"><b>Password</b></label> 
          <div class="col-12">
            <input id="password" type="password" name="password" class="form-control" required="required">       
          </div>
        </div>

    <div class="form-group col-12">
              <button name="submit" type="submit" class="btn btn-outline-secondary btn-block">Submit</button>
      </div>
  </form>
  <?php

    $host = "localhost";
    $user = "dbuser";
    $password = "goodbyeWorld";
    $database = "climbingdb";
    $table = "users";

    $db_connection = new mysqli($host, $user, $password, $database);
    if ($db_connection->connect_error) {
      die($db_connection->connect_error);
    } 
    else {
      $firstName = "manan";
      $lastName = "Bhalodia";
      $level = 5;
      $email = trim($_POST["id"]);
      $password = password_hash(trim($_POST["password"]), PASSWORD_DEFAULT);
      $query = "Insert into applicants (fistName, lastName email, password, level) values ('$firstName', '$lastName', '$email', '$level', $password')";
      $result = $db_connection->query($query);
      if ($result) {
            echo "<h3>The following entry has been added to the database</h3>";
      } 
      else {           
        echo "<h3>Insertion failed: ".$db_connection->error."</h3>";
      }
      $db_connection->close();
      echo generatePage($body);
    }

    // if(isset($_POST['submit']))
    // {
    //   $id = trim($_POST['id']);
    //   $pass = trim($_POST['password']);
    //   $valid_id = 'testudo';
    //   $valid_pass = 'terps';
    //   if($id == $valid_id && $pass == $valid_pass)
    //   {
    //       $_SESSION['id'] = $id;
    //       $_SESSION['count'] = 0;
    //       header('Location: map.html');
    //   }
    //   else
    //   {
    //     echo "<h6>Invalid login information provided</h6>";
    //   }
    // }
  
  ?>
  </body>
</html>